["{\"transientOutputs\":false,\"transientCellMetadata\":{\"breakpointMargin\":true,\"id\":false,\"metadata\":false,\"attachments\":false},\"transientDocumentMetadata\":{\"cells\":true,\"indentAmount\":true},\"cellContentMetadata\":{\"attachments\":true}}","{\"cells\":[{\"cellKind\":1,\"language\":\"markdown\",\"metadata\":{\"metadata\":{},\"id\":\"4d8fd73a\"},\"outputs\":[],\"source\":\"# Feature & Target Pipeline\\nQuick smoke test that mirrors production: build features, derive targets, combine them, and prepare time-based splits.\",\"internalMetadata\":{\"internalId\":\"65dc8abb\"}},{\"cellKind\":2,\"language\":\"python\",\"metadata\":{\"execution_count\":2,\"id\":\"64b95c13\",\"metadata\":{}},\"outputs\":[{\"outputId\":\"64fdc9cd-bf4b-440f-ab4a-2d62fd16c71f\",\"metadata\":{\"outputType\":\"stream\"},\"outputs\":[{\"data\":{\"type\":\"ArrayBuffer-4f56482b-5a03-49ba-8356-210d3b0c1c3d\",\"data\":\"L2hvbWUvZWFzdC9zaGFyZWQvZWFzdFN5bmMvcHlFYXN0L3Byb192ZXJzaW9uLy52ZW52L2xpYi9weXRob24zLjEzL3NpdGUtcGFja2FnZXMvdHFkbS9hdXRvLnB5OjIxOiBUcWRtV2FybmluZzogSVByb2dyZXNzIG5vdCBmb3VuZC4gUGxlYXNlIHVwZGF0ZSBqdXB5dGVyIGFuZCBpcHl3aWRnZXRzLiBTZWUgaHR0cHM6Ly9pcHl3aWRnZXRzLnJlYWR0aGVkb2NzLmlvL2VuL3N0YWJsZS91c2VyX2luc3RhbGwuaHRtbAogIGZyb20gLmF1dG9ub3RlYm9vayBpbXBvcnQgdHFkbSBhcyBub3RlYm9va190cWRtCg==\"},\"mime\":\"application/vnd.code.notebook.stderr\"}]},{\"outputId\":\"4a425eb6-ec89-4e0e-8221-0c2ead3f82c3\",\"metadata\":{\"outputType\":\"stream\"},\"outputs\":[{\"data\":{\"type\":\"ArrayBuffer-4f56482b-5a03-49ba-8356-210d3b0c1c3d\",\"data\":\"SW1wb3J0cyBhbmQgY29uZmlndXJhdGlvbiByZWFkeQo9PT0gTG9hZGluZyAuaGlzdF9kYl8xaC5jc3YgPT09CgpJbml0aWFsIHJvd3M6IDUzLDk2MwoKPT09IEZPVU5EIElTU1VFUyAocHJpb3IgdG8gYXV0b21hdGVkIGZpeGVzKSA9PT0KCvCflLQgVEVNUE9SQUw6IE1pc3NpbmcgaG91cnM6IDEgY2FzZXMKICBNaXNzaW5nIHRpbWVzdGFtcHMgc2FtcGxlOgogICAgMjAyNS0xMS0wNCAxMzowMDowMAoK8J+UtCBEQVRBIElOVEVHUklUWTogSWRlbnRpY2FsIGNvbnNlY3V0aXZlIE9ITEMgcm93czogMTc0IGNhc2VzCiAgU2FtcGxlIGNhc2VzOgogICAgeydvJzogJzcxMTAuMTAnLCAnaCc6ICc3MTEwLjEwJywgJ2wnOiAnNzExMC4xMCcsICdjJzogJzcxMTAuMTAnLCAndm9sQ2N5JzogJzAuMDAnfQogICAgeydvJzogJzcxMTAuMTAnLCAnaCc6ICc3MTEwLjEwJywgJ2wnOiAnNzExMC4xMCcsICdjJzogJzcxMTAuMTAnLCAndm9sQ2N5JzogJzAuMDAnfQogICAgeydvJzogJzcxMTAuMTAnLCAnaCc6ICc3MTEwLjEwJywgJ2wnOiAnNzExMC4xMCcsICdjJzogJzcxMTAuMTAnLCAndm9sQ2N5JzogJzAuMDAnfQogIEFmZmVjdGVkIGRhdGVzIChzYW1wbGUpOiAyMDIwLTAxLTAyLCAyMDIwLTAxLTAzLCAyMDIwLTAxLTA0LCAyMDIwLTAxLTA1LCAyMDIwLTAxLTA2Cgo9PT0gQVBQTFlJTkcgQVVUT01BVEVEIEZJWEVTID09PQpBQ1RJT046IFJlc2FtcGxlZC9SZWluZGV4ZWQgdG8gNTM5NjQgaG91cmx5IGludGVydmFscyAod2FzIDUzOTYzKS4KQUNUSU9OOiBGb3J3YXJkLWZpbGxlZCBOYU5zIGFmdGVyIHJlc2FtcGxpbmcuICg1IE5hTnMgcG90ZW50aWFsbHkgZmlsbGVkIGJ5IGZmaWxsKS4KCj09PSBGSU5BTCBTVEFUVVMgKGFmdGVyIGF1dG9tYXRlZCBmaXhlcykgPT09CkRhdGFGcmFtZSBzaGFwZSBwb3N0LWZpeGVzOiAoNTM5NjQsIDUpIChPcmlnaW5hbDogKDUzOTYzLCA2KSkKRGF0ZSByYW5nZTogMjAxOS0xMC0wMSAwMDowMDowMCB0byAyMDI1LTExLTI2IDExOjAwOjAwCk5vIG51bGwgdmFsdWVzIHJlbWFpbmluZyBhZnRlciBmaXhlcy4KVG90YWwgbnVsbCB2YWx1ZXMgcmVtYWluaW5nIGFmdGVyIGZpeGVzOiAwCkhlYXZ5IGNhY2hlIHJlYWR5OiBoZWF2eV9mZWF0dXJlc192MS5wa2wgKHRvdGFsIDEpIGluIGNhY2hlL2hlYXZ5X2ZlYXR1cmVzCkhlYXZ5IGNhY2hlIG5vdCBhdmFpbGFibGUgb3IgZmFpbGVkIHRvIGxvYWQ7IHJ1bm5pbmcgZnVsbCBmaXQuCmRlcml2ZWRfcHJvYmFfY29uZmlnOiB7J2VuYWJsZWQnOiBGYWxzZSwgJ21vZGVsc19kaXJlY3RvcnknOiAncmVzZWFyY2hfdm9sL3RyYWluZWRfbW9kZWxzJywgJ2ZpbGVfcGF0dGVybic6ICdjYXRib29zdF8qX2hwdF9idW5kbGUucGtsJywgJ21vZGVsc190b191c2UnOiB7fX0KWydvJywgJ2gnLCAnbCcsICdjJywgJ3ZvbENjeScsICd0aW1lX3RvX2V4cDFfaHInLCAndGltZV9lbGFwc2VkJywgJ2hvdXInLCAnZGF5X29mX3dlZWsnLCAnaXNfd2Vla2VuZCcsICdob3VyX29mX3dlZWsnLCAnaG91cl9vZl93ZWVrX3NpbicsICdob3VyX29mX3dlZWtfY29zJywgJ2hvdXJzX3NpbmNlX3dlZWtfc3RhcnQnLCAnZGF5X3R5cGVfbnVtJywgJ3ByZXZfY2xvc2UnLCAndm9sQ2N5X3ByZXYnLCAnd2luZG93X3ByZXZfY2xvc2UnLCAncmV0dXJuc18xaCcsICdyZXR1cm5zXzJoJywgJ2xvZ3JldF8yaCcsICdyZXR1cm5zXzNoJywgJ2xvZ3JldF8zaCcsICdyZXR1cm5zXzRoJywgJ2xvZ3JldF80aCcsICdyZXR1cm5zXzVoJywgJ2xvZ3JldF81aCcsICdyZXR1cm5zXzZoJywgJ2xvZ3JldF82aCcsICdyZXR1cm5zXzEyaCcsICdsb2dyZXRfMTJoJywgJ3JldHVybnNfMjRoJywgJ2xvZ3JldF8yNGgnLCAncmV0dXJuc183MmgnLCAnbG9ncmV0XzcyaCcsICdyZXR1cm5zXzF3aycsICdyZXR1cm5zXzFNJywgJ3JldF9oX3BjJywgJ3JldF9sX3BjJywgJ3JldF9jX3BjJywgJ3JldF9oX2wnLCAncmFuZ2VfMmgnLCAncmFuZ2VfcGNfMmgnLCAncmFuZ2VfM2gnLCAncmFuZ2VfcGNfM2gnLCAncmFuZ2VfNmgnLCAncmFuZ2VfcGNfNmgnLCAncmFuZ2VfMTJoJywgJ3JhbmdlX3BjXzEyaCcsICdyYW5nZV8yNGgnLCAncmFuZ2VfcGNfMjRoJywgJ3JhbmdlJywgJ3JhbmdlX3BjJywgJ2Nsb3NlX3RvX2hpZ2gnLCAnY2xvc2VfdG9fbG93JywgJ2Nsb3NlX3Bvc19pbl9iYXInLCAnbG9ncmV0X2hfcGMnLCAnbG9ncmV0X2xfcGMnLCAnbG9ncmV0X2NfcGMnLCAnaXNfZHN0JywgJ3R0ZV9waGFzZV9jb3MnLCAndHRlX3BoYXNlX3NpbicsICdtb21lbnR1bV8zaCcsICdtb21lbnR1bV9zaWduZWRfc3FydF8zaCcsICd0cmVuZF9zdHJlbmd0aF8zaCcsICdtb21lbnR1bV82aCcsICdtb21lbnR1bV9zaWduZWRfc3FydF82aCcsICd0cmVuZF9zdHJlbmd0aF82aCcsICdtb21lbnR1bV8xMmgnLCAnbW9tZW50dW1fc2lnbmVkX3NxcnRfMTJoJywgJ3RyZW5kX3N0cmVuZ3RoXzEyaCcsICdtb21lbnR1bV8yNGgnLCAnbW9tZW50dW1fc2lnbmVkX3NxcnRfMjRoJywgJ3RyZW5kX3N0cmVuZ3RoXzI0aCcsICdtb21lbnR1bV83MmgnLCAnbW9tZW50dW1fc2lnbmVkX3NxcnRfNzJoJywgJ3RyZW5kX3N0cmVuZ3RoXzcyaCcsICdtb21lbnR1bV8xNDRoJywgJ21vbWVudHVtX3NpZ25lZF9zcXJ0XzE0NGgnLCAndHJlbmRfc3RyZW5ndGhfMTQ0aCcsICdtb21lbnR1bV8yODhoJywgJ21vbWVudHVtX3NpZ25lZF9zcXJ0XzI4OGgnLCAndHJlbmRfc3RyZW5ndGhfMjg4aCcsICdtYWNkJywgJ21hY2Rfc2lnbmFsJywgJ21hY2RfaGlzdCcsICdhZHgnLCAnYWR4X3BvcycsICdhZHhfbmVnJywgJ3N0b2NoX3Bvc18zaCcsICdkaXN0X2Zyb21faGlnaF8zaCcsICdkaXN0X2Zyb21fbG93XzNoJywgJ3ByaWNlX3JhbmtfM2gnLCAnc3RvY2hfcG9zXzZoJywgJ2Rpc3RfZnJvbV9oaWdoXzZoJywgJ2Rpc3RfZnJvbV9sb3dfNmgnLCAncHJpY2VfcmFua182aCcsICdzdG9jaF9wb3NfMTJoJywgJ2Rpc3RfZnJvbV9oaWdoXzEyaCcsICdkaXN0X2Zyb21fbG93XzEyaCcsICdwcmljZV9yYW5rXzEyaCcsICdzdG9jaF9wb3NfMjRoJywgJ2Rpc3RfZnJvbV9oaWdoXzI0aCcsICdkaXN0X2Zyb21fbG93XzI0aCcsICdwcmljZV9yYW5rXzI0aCcsICdzdG9jaF9wb3NfNzJoJywgJ2Rpc3RfZnJvbV9oaWdoXzcyaCcsICdkaXN0X2Zyb21fbG93XzcyaCcsICdwcmljZV9yYW5rXzcyaCcsICdzdG9jaF9wb3NfMTQ0aCcsICdkaXN0X2Zyb21faGlnaF8xNDRoJywgJ2Rpc3RfZnJvbV9sb3dfMTQ0aCcsICdwcmljZV9yYW5rXzE0NGgnLCAnc3RvY2hfcG9zXzI4OGgnLCAnZGlzdF9mcm9tX2hpZ2hfMjg4aCcsICdkaXN0X2Zyb21fbG93XzI4OGgnLCAncHJpY2VfcmFua18yODhoJywgJ25ld18yNGhfaGlnaCcsICduZXdfMjRoX2xvdycsICd2bG1fbWFfM2gnLCAndmxtX3pzY29yZV8zaCcsICd2bG1fbWFfNmgnLCAndmxtX3pzY29yZV82aCcsICd2bG1fbWFfMTJoJywgJ3ZsbV96c2NvcmVfMTJoJywgJ3ZsbV9tYV8yNGgnLCAndmxtX3pzY29yZV8yNGgnLCAndmxtX21hXzcyaCcsICd2bG1fenNjb3JlXzcyaCcsICd2bG1fbWFfMTQ0aCcsICd2bG1fenNjb3JlXzE0NGgnLCAndmxtX21hXzI4OGgnLCAndmxtX3pzY29yZV8yODhoJywgJ3ZvbF9yYXdfM2gnLCAndm9sX2dreXpfM2gnLCAndm9sX3BhcmtpbnNvbl8zaCcsICd2b2xfenNjb3JlXzNoJywgJ2xvZ192b2xfM2gnLCAndm9sX3Jhd182aCcsICd2b2xfZ2t5el82aCcsICd2b2xfcGFya2luc29uXzZoJywgJ3ZvbF96c2NvcmVfNmgnLCAnbG9nX3ZvbF82aCcsICd2b2xfcmF3XzEyaCcsICd2b2xfZ2t5el8xMmgnLCAndm9sX3BhcmtpbnNvbl8xMmgnLCAndm9sX3pzY29yZV8xMmgnLCAnbG9nX3ZvbF8xMmgnLCAndm9sX3Jhd18yNGgnLCAndm9sX2dreXpfMjRoJywgJ3ZvbF9wYXJraW5zb25fMjRoJywgJ3ZvbF96c2NvcmVfMjRoJywgJ2xvZ192b2xfMjRoJywgJ3ZvbF9yYXdfNzJoJywgJ3ZvbF9na3l6XzcyaCcsICd2b2xfcGFya2luc29uXzcyaCcsICd2b2xfenNjb3JlXzcyaCcsICdsb2dfdm9sXzcyaCcsICd2b2xfcmF3XzE0NGgnLCAndm9sX2dreXpfMTQ0aCcsICd2b2xfcGFya2luc29uXzE0NGgnLCAndm9sX3pzY29yZV8xNDRoJywgJ2xvZ192b2xfMTQ0aCcsICd2b2xfcmF3XzI4OGgnLCAndm9sX2dreXpfMjg4aCcsICd2b2xfcGFya2luc29uXzI4OGgnLCAndm9sX3pzY29yZV8yODhoJywgJ2xvZ192b2xfMjg4aCcsICdyZXR1cm5zX3NrZXdfMjRoJywgJ3JldHVybnNfa3VydG9zaXNfMjRoJywgJ3ZvbF9yYXRpb18yNGhfMTQ0aCcsICd2b2xfcmF0aW9fMjRoXzI4OGgnLCAnZXhwX3JldF9wOTBfMjRoJywgJ2V4cF9yZXRfcDc1XzI0aCcsICdleHBfcmV0X3AyNV8yNGgnLCAnZXhwX3JldF9wMTBfMjRoJywgJ2V4cF9iYW5kX3dpZHRoXzI0aCcsICdleHBfbG9nbW92ZV9wOTBfMjRoJywgJ2V4cF9sb2dtb3ZlX3AxMF8yNGgnLCAnZXhwX3JldF9wOTBfdHRlJywgJ2V4cF9yZXRfcDEwX3R0ZScsICdleHBfYmFuZF93aWR0aF90dGUnLCAnZXhwX2xvZ21vdmVfcDkwX3R0ZScsICdleHBfbG9nbW92ZV9wMTBfdHRlJywgJ3JlYWxpemVkX3RvX2V4cGVjdGVkXzI0aCcsICdyZWFsaXplZF90b19leHBlY3RlZF90dGUnLCAncHJldl93ZWVrZGF5X1Byb2dBY3RQJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWluUCcsICdwcmV2X3dlZWtkYXlfUHJvZ01heFAnLCAncHJldl93ZWVrZGF5X1Byb2dNaW5UJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWF4VCcsICdwcmV2X3dlZWtkYXlfUHJvZ1ZsbScsICdwcmV2X3dlZWtkYXlfUmVtQWN0UCcsICdwcmV2X3dlZWtkYXlfUmVtTWluUCcsICdwcmV2X3dlZWtkYXlfUmVtTWF4UCcsICdwcmV2X3dlZWtkYXlfUmVtTWluVCcsICdwcmV2X3dlZWtkYXlfUmVtTWF4VCcsICdwcmV2X3NhdHVyZGF5X1Byb2dBY3RQJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ01pblAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWF4UCcsICdwcmV2X3NhdHVyZGF5X1Byb2dNaW5UJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ01heFQnLCAncHJldl9zYXR1cmRheV9Qcm9nVmxtJywgJ3ByZXZfc2F0dXJkYXlfUmVtQWN0UCcsICdwcmV2X3NhdHVyZGF5X1JlbU1pblAnLCAncHJldl9zYXR1cmRheV9SZW1NYXhQJywgJ3ByZXZfc2F0dXJkYXlfUmVtTWluVCcsICdwcmV2X3NhdHVyZGF5X1JlbU1heFQnLCAncHJldl9zdW5kYXlfUHJvZ0FjdFAnLCAncHJldl9zdW5kYXlfUHJvZ01pblAnLCAncHJldl9zdW5kYXlfUHJvZ01heFAnLCAncHJldl9zdW5kYXlfUHJvZ01pblQnLCAncHJldl9zdW5kYXlfUHJvZ01heFQnLCAncHJldl9zdW5kYXlfUHJvZ1ZsbScsICdwcmV2X3N1bmRheV9SZW1BY3RQJywgJ3ByZXZfc3VuZGF5X1JlbU1pblAnLCAncHJldl9zdW5kYXlfUmVtTWF4UCcsICdwcmV2X3N1bmRheV9SZW1NaW5UJywgJ3ByZXZfc3VuZGF5X1JlbU1heFQnLCAncHJldl93ZWVrZGF5X1Byb2dNaW5QX21lZF85MCcsICdwcmV2X3dlZWtkYXlfUHJvZ01pblBfcDEwXzkwJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWluUF9wOTBfOTAnLCAncHJldl93ZWVrZGF5X1Byb2dNYXhQX21lZF85MCcsICdwcmV2X3dlZWtkYXlfUHJvZ01heFBfcDEwXzkwJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWF4UF9wOTBfOTAnLCAncHJldl93ZWVrZGF5X1JlbU1pblBfbWVkXzkwJywgJ3ByZXZfd2Vla2RheV9SZW1NaW5QX3AxMF85MCcsICdwcmV2X3dlZWtkYXlfUmVtTWluUF9wOTBfOTAnLCAncHJldl93ZWVrZGF5X1JlbU1heFBfbWVkXzkwJywgJ3ByZXZfd2Vla2RheV9SZW1NYXhQX3AxMF85MCcsICdwcmV2X3dlZWtkYXlfUmVtTWF4UF9wOTBfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF9tZWRfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF9wMTBfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF9wOTBfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWF4UF9tZWRfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWF4UF9wMTBfOTAnLCAncHJldl9zYXR1cmRheV9Qcm9nTWF4UF9wOTBfOTAnLCAncHJldl9zYXR1cmRheV9SZW1NaW5QX21lZF85MCcsICdwcmV2X3NhdHVyZGF5X1JlbU1pblBfcDEwXzkwJywgJ3ByZXZfc2F0dXJkYXlfUmVtTWluUF9wOTBfOTAnLCAncHJldl9zYXR1cmRheV9SZW1NYXhQX21lZF85MCcsICdwcmV2X3NhdHVyZGF5X1JlbU1heFBfcDEwXzkwJywgJ3ByZXZfc2F0dXJkYXlfUmVtTWF4UF9wOTBfOTAnLCAncHJldl9zdW5kYXlfUHJvZ01pblBfbWVkXzkwJywgJ3ByZXZfc3VuZGF5X1Byb2dNaW5QX3AxMF85MCcsICdwcmV2X3N1bmRheV9Qcm9nTWluUF9wOTBfOTAnLCAncHJldl9zdW5kYXlfUHJvZ01heFBfbWVkXzkwJywgJ3ByZXZfc3VuZGF5X1Byb2dNYXhQX3AxMF85MCcsICdwcmV2X3N1bmRheV9Qcm9nTWF4UF9wOTBfOTAnLCAncHJldl9zdW5kYXlfUmVtTWluUF9tZWRfOTAnLCAncHJldl9zdW5kYXlfUmVtTWluUF9wMTBfOTAnLCAncHJldl9zdW5kYXlfUmVtTWluUF9wOTBfOTAnLCAncHJldl9zdW5kYXlfUmVtTWF4UF9tZWRfOTAnLCAncHJldl9zdW5kYXlfUmVtTWF4UF9wMTBfOTAnLCAncHJldl9zdW5kYXlfUmVtTWF4UF9wOTBfOTAnLCAnZW1wX2ZyZXFfbG9ncmV0X2hfcGNfZ2VfMC4wMDAxJywgJ2VtcF9mcmVxX2xvZ3JldF9sX3BjX2xlXy0wLjAwMDEnLCAnZW1wX2ZyZXFfbG9ncmV0X2hfcGNfZ2VfMC4wMDA1JywgJ2VtcF9mcmVxX2xvZ3JldF9sX3BjX2xlXy0wLjAwMDUnLCAnZW1wX2ZyZXFfbG9ncmV0X2hfcGNfZ2VfMC4wMDEnLCAnZW1wX2ZyZXFfbG9ncmV0X2xfcGNfbGVfLTAuMDAxJywgJ2VtcF9wY3RfNV9sb2dyZXRfaF9wYycsICdlbXBfcGN0XzVfbG9ncmV0X2xfcGMnLCAnZW1wX3BjdF8zMF9sb2dyZXRfaF9wYycsICdlbXBfcGN0XzMwX2xvZ3JldF9sX3BjJywgJ2VtcF9wY3RfNTBfbG9ncmV0X2hfcGMnLCAnZW1wX3BjdF81MF9sb2dyZXRfbF9wYycsICdlbXBfcGN0XzcwX2xvZ3JldF9oX3BjJywgJ2VtcF9wY3RfNzBfbG9ncmV0X2xfcGMnLCAnZW1wX3BjdF85NV9sb2dyZXRfaF9wYycsICdlbXBfcGN0Xzk1X2xvZ3JldF9sX3BjJywgJ2VtcF9tZWRpYW5fbG9ncmV0X3JhbmdlJywgJ2VtcF9tZWRpYW5fcmVhbGl6ZWRfdG9fZXhwZWN0ZWRfMjRoJywgJ2VtcF9tZWRpYW5fcmVhbGl6ZWRfdG9fZXhwZWN0ZWRfdHRlJywgJ2NDUHJvZ0FjdFAnLCAnY0NQcm9nTWluUCcsICdjQ1Byb2dNYXhQJywgJ2NDUHJvZ01pblQnLCAnY0NQcm9nTWF4VCcsICdjQ1Byb2dWbG0nLCAndm9sX3dlaWdodGVkX3ZvbCcsICd2b2xfdmxtX3JhdGlvX2NoYW5nZScsICdhc3ltX3ZvbF92bG1faW1wYWN0JywgJ21vbWVudHVtX2FjY2VsXzZoJywgJ21vbWVudHVtX2FjY2VsXzEyaCcsICdtb21lbnR1bV9hY2NlbF8yNGgnLCAnc2lnbmVkX21vbWVudHVtX3Bvd2VyJywgJ21vbV92b2xfaW50ZXJhY3Rpb24nLCAnY29tcHJlc3NlZF9yYW5nZV92b2wnLCAncmFuZ2VfZXhwYW5zaW9uJywgJ25sX3Bvc19pbl9yYW5nZScsICd2b2x1bWVfc3VycHJpc2UnLCAnbGlxX3ZvbCcsICdsaXFfdm9sX3JhdGlvX2NoYW5nZScsICd2b2x1bWVfdHJlbmRfeicsICdleHBfZGVjYXlfcmV0XzZoJywgJ2V4cF9kZWNheV9yZXRfMTJoJywgJ2V4cF9kZWNheV9yZXRfMjRoJywgJ3RpbWVfYWRqX3ZvbCcsICdjeWNsaWNhbF92b2xfY29tcHJlc3Npb24nLCAnZXh0cmVtZV9wcm9iJywgJ3ZvbF9jbHVzdGVyaW5nJywgJ3ZvbF9na3l6XzI0aF94X3R0ZV9zcXJ0JywgJ3ZvbF9na3l6XzI0aF94X3R0ZScsICd2b2xfZ2t5el8yNGhfeF90dGVfc3EnLCAndm9sX2dreXpfMjRoX3hfdHRlX2N1JywgJ3ZsbV9tYV8yNGhfeF90dGVfc3FydCcsICd2bG1fbWFfMjRoX3hfdHRlJywgJ3ZsbV9tYV8yNGhfeF90dGVfc3EnLCAndmxtX21hXzI0aF94X3R0ZV9jdScsICdyZXR1cm5zX2t1cnRvc2lzXzI0aF94X3R0ZV9zcXJ0JywgJ3JldHVybnNfa3VydG9zaXNfMjRoX3hfdHRlJywgJ3JldHVybnNfa3VydG9zaXNfMjRoX3hfdHRlX3NxJywgJ3JldHVybnNfa3VydG9zaXNfMjRoX3hfdHRlX2N1JywgJ3JldHVybnNfc2tld18yNGhfeF90dGVfc3FydCcsICdyZXR1cm5zX3NrZXdfMjRoX3hfdHRlJywgJ3JldHVybnNfc2tld18yNGhfeF90dGVfc3EnLCAncmV0dXJuc19za2V3XzI0aF94X3R0ZV9jdScsICdleHRyZW1lX3Byb2JfeF90dGVfc3FydCcsICdleHRyZW1lX3Byb2JfeF90dGUnLCAnZXh0cmVtZV9wcm9iX3hfdHRlX3NxJywgJ2V4dHJlbWVfcHJvYl94X3R0ZV9jdScsICd2b2xfY2x1c3RlcmluZ194X3R0ZV9zcXJ0JywgJ3ZvbF9jbHVzdGVyaW5nX3hfdHRlJywgJ3ZvbF9jbHVzdGVyaW5nX3hfdHRlX3NxJywgJ3ZvbF9jbHVzdGVyaW5nX3hfdHRlX2N1JywgJ2V4cF9yZXRfcDkwXzI0aF94X3R0ZV9zcXJ0JywgJ2V4cF9yZXRfcDkwXzI0aF94X3R0ZScsICdleHBfcmV0X3A5MF8yNGhfeF90dGVfc3EnLCAnZXhwX3JldF9wOTBfMjRoX3hfdHRlX2N1JywgJ2V4cF9yZXRfcDEwXzI0aF94X3R0ZV9zcXJ0JywgJ2V4cF9yZXRfcDEwXzI0aF94X3R0ZScsICdleHBfcmV0X3AxMF8yNGhfeF90dGVfc3EnLCAnZXhwX3JldF9wMTBfMjRoX3hfdHRlX2N1JywgJ2V4cF9iYW5kX3dpZHRoXzI0aF94X3R0ZV9zcXJ0JywgJ2V4cF9iYW5kX3dpZHRoXzI0aF94X3R0ZScsICdleHBfYmFuZF93aWR0aF8yNGhfeF90dGVfc3EnLCAnZXhwX2JhbmRfd2lkdGhfMjRoX3hfdHRlX2N1JywgJ2V4cF9yZXRfcDkwX3R0ZV94X3R0ZV9zcXJ0JywgJ2V4cF9yZXRfcDkwX3R0ZV94X3R0ZScsICdleHBfcmV0X3A5MF90dGVfeF90dGVfc3EnLCAnZXhwX3JldF9wOTBfdHRlX3hfdHRlX2N1JywgJ2V4cF9yZXRfcDEwX3R0ZV94X3R0ZV9zcXJ0JywgJ2V4cF9yZXRfcDEwX3R0ZV94X3R0ZScsICdleHBfcmV0X3AxMF90dGVfeF90dGVfc3EnLCAnZXhwX3JldF9wMTBfdHRlX3hfdHRlX2N1JywgJ2V4cF9iYW5kX3dpZHRoX3R0ZV94X3R0ZV9zcXJ0JywgJ2V4cF9iYW5kX3dpZHRoX3R0ZV94X3R0ZScsICdleHBfYmFuZF93aWR0aF90dGVfeF90dGVfc3EnLCAnZXhwX2JhbmRfd2lkdGhfdHRlX3hfdHRlX2N1JywgJ3Nob2NrX2Fic29ycHRpb24nLCAndm9sX2dreXpfM2hfeF90dGVfc3FydCcsICd2b2xfZ2t5el8zaF94X3R0ZScsICd2b2xfZ2t5el8zaF94X3R0ZV9zcScsICd2b2xfZ2t5el8zaF94X3R0ZV9zaW4nLCAndm9sX2dreXpfM2hfeF90dGVfY29zJywgJ3ZvbF9na3l6XzZoX3hfdHRlX3NxcnQnLCAndm9sX2dreXpfNmhfeF90dGUnLCAndm9sX2dreXpfNmhfeF90dGVfc3EnLCAndm9sX2dreXpfNmhfeF90dGVfc2luJywgJ3ZvbF9na3l6XzZoX3hfdHRlX2NvcycsICd2b2xfZ2t5el8xMmhfeF90dGVfc3FydCcsICd2b2xfZ2t5el8xMmhfeF90dGUnLCAndm9sX2dreXpfMTJoX3hfdHRlX3NxJywgJ3ZvbF9na3l6XzEyaF94X3R0ZV9zaW4nLCAndm9sX2dreXpfMTJoX3hfdHRlX2NvcycsICd2b2xfZ2t5el8yNGhfeF90dGVfc2luJywgJ3ZvbF9na3l6XzI0aF94X3R0ZV9jb3MnLCAndm9sX2dreXpfMjg4aF94X3R0ZV9zcXJ0JywgJ3ZvbF9na3l6XzI4OGhfeF90dGUnLCAndm9sX2dreXpfMjg4aF94X3R0ZV9zcScsICd2b2xfZ2t5el8yODhoX3hfdHRlX3NpbicsICd2b2xfZ2t5el8yODhoX3hfdHRlX2NvcycsICd2b2xfcmF3XzI0aF94X3R0ZV9zcXJ0JywgJ3ZvbF9yYXdfMjRoX3hfdHRlJywgJ3ZvbF9yYXdfMjRoX3hfdHRlX3NxJywgJ3ZvbF9yYXdfMjRoX3hfdHRlX3NpbicsICd2b2xfcmF3XzI0aF94X3R0ZV9jb3MnLCAndm9sX3Jhd18yODhoX3hfdHRlX3NxcnQnLCAndm9sX3Jhd18yODhoX3hfdHRlJywgJ3ZvbF9yYXdfMjg4aF94X3R0ZV9zcScsICd2b2xfcmF3XzI4OGhfeF90dGVfc2luJywgJ3ZvbF9yYXdfMjg4aF94X3R0ZV9jb3MnLCAndm9sX3Rlcm1feF90dGVfc3FydCcsICd2b2xfdGVybV94X3R0ZScsICd2b2xfdGVybV94X3R0ZV9zcScsICd2b2xfZ2t5el8zaF93ZWVrZW5kJywgJ3ZvbF9na3l6XzNoX3dlZWtkYXknLCAndm9sX2dreXpfNmhfd2Vla2VuZCcsICd2b2xfZ2t5el82aF93ZWVrZGF5JywgJ3ZvbF9na3l6XzEyaF93ZWVrZW5kJywgJ3ZvbF9na3l6XzEyaF93ZWVrZGF5JywgJ3ZvbF9na3l6XzI0aF93ZWVrZW5kJywgJ3ZvbF9na3l6XzI0aF93ZWVrZGF5JywgJ3ByZXZfc2F0dXJkYXlfUHJvZ0FjdFBfd2Vla2VuZCcsICdwcmV2X3NhdHVyZGF5X1Byb2dNYXhQX3dlZWtlbmQnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF93ZWVrZW5kJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ1ZsbV93ZWVrZW5kJywgJ3ByZXZfc3VuZGF5X1Byb2dBY3RQX3dlZWtlbmQnLCAncHJldl9zdW5kYXlfUHJvZ01heFBfd2Vla2VuZCcsICdwcmV2X3N1bmRheV9Qcm9nTWluUF93ZWVrZW5kJywgJ3ByZXZfc3VuZGF5X1Byb2dWbG1fd2Vla2VuZCcsICd2b2x1bWVfd2Vla2VuZF9lZmZlY3QnLCAncHJldl93ZWVrZGF5X1Byb2dBY3RQX3hfdm9sNmgnLCAncHJldl93ZWVrZGF5X1Byb2dBY3RQX3hfdm9sMTJoJywgJ3ByZXZfd2Vla2RheV9Qcm9nQWN0UF94X3ZvbDI0aCcsICdwcmV2X3dlZWtkYXlfUHJvZ01heFBfeF92b2w2aCcsICdwcmV2X3dlZWtkYXlfUHJvZ01heFBfeF92b2wxMmgnLCAncHJldl93ZWVrZGF5X1Byb2dNYXhQX3hfdm9sMjRoJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWluUF94X3ZvbDZoJywgJ3ByZXZfd2Vla2RheV9Qcm9nTWluUF94X3ZvbDEyaCcsICdwcmV2X3dlZWtkYXlfUHJvZ01pblBfeF92b2wyNGgnLCAncHJldl93ZWVrZGF5X1Byb2dWbG1feF92b2w2aCcsICdwcmV2X3dlZWtkYXlfUHJvZ1ZsbV94X3ZvbDEyaCcsICdwcmV2X3dlZWtkYXlfUHJvZ1ZsbV94X3ZvbDI0aCcsICdwcmV2X3NhdHVyZGF5X1Byb2dBY3RQX3hfdm9sNmgnLCAncHJldl9zYXR1cmRheV9Qcm9nQWN0UF94X3ZvbDEyaCcsICdwcmV2X3NhdHVyZGF5X1Byb2dBY3RQX3hfdm9sMjRoJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ01heFBfeF92b2w2aCcsICdwcmV2X3NhdHVyZGF5X1Byb2dNYXhQX3hfdm9sMTJoJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ01heFBfeF92b2wyNGgnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF94X3ZvbDZoJywgJ3ByZXZfc2F0dXJkYXlfUHJvZ01pblBfeF92b2wxMmgnLCAncHJldl9zYXR1cmRheV9Qcm9nTWluUF94X3ZvbDI0aCcsICdwcmV2X3NhdHVyZGF5X1Byb2dWbG1feF92b2w2aCcsICdwcmV2X3NhdHVyZGF5X1Byb2dWbG1feF92b2wxMmgnLCAncHJldl9zYXR1cmRheV9Qcm9nVmxtX3hfdm9sMjRoJywgJ3ByZXZfc3VuZGF5X1Byb2dBY3RQX3hfdm9sNmgnLCAncHJldl9zdW5kYXlfUHJvZ0FjdFBfeF92b2wxMmgnLCAncHJldl9zdW5kYXlfUHJvZ0FjdFBfeF92b2wyNGgnLCAncHJldl9zdW5kYXlfUHJvZ01heFBfeF92b2w2aCcsICdwcmV2X3N1bmRheV9Qcm9nTWF4UF94X3ZvbDEyaCcsICdwcmV2X3N1bmRheV9Qcm9nTWF4UF94X3ZvbDI0aCcsICdwcmV2X3N1bmRheV9Qcm9nTWluUF94X3ZvbDZoJywgJ3ByZXZfc3VuZGF5X1Byb2dNaW5QX3hfdm9sMTJoJywgJ3ByZXZfc3VuZGF5X1Byb2dNaW5QX3hfdm9sMjRoJywgJ3ByZXZfc3VuZGF5X1Byb2dWbG1feF92b2w2aCcsICdwcmV2X3N1bmRheV9Qcm9nVmxtX3hfdm9sMTJoJywgJ3ByZXZfc3VuZGF5X1Byb2dWbG1feF92b2wyNGgnLCAncHJldl93ZWVrZGF5X3JhbmdlX3hfdm9sJywgJ3ByZXZfc2F0dXJkYXlfcmFuZ2VfeF92b2wnLCAncHJldl9zdW5kYXlfcmFuZ2VfeF92b2wnLCAnd2Vla2RheV92c19zYXR1cmRheV9wcm9nJywgJ3dlZWtkYXlfdnNfc3VuZGF5X3Byb2cnLCAncHJldl9jeWNsZV9wcm9ncmVzc194X2hvdXInLCAnZXh0cmVtZV9yYW5nZV92b2wnLCAnc2tld192b2xfZXh0cmVtZScsICdrdXJ0b3Npc192b2xfZXh0cmVtZScsICdkaXN0YW5jZV92b2xfZXh0cmVtZScsICd2b2xfc3VycHJpc2VfY2x1c3RlcmluZyddCg==\"},\"mime\":\"application/vnd.code.notebook.stdout\"}]}],\"source\":\"import pandas as pd\\nfrom pathlib import Path\\nfrom typing import Optional\\n\\nfrom data_pipeline import load_data  # This just loads the data and cleans it\\n\\nfrom featureEngineer import FeatureEngineer\\nfrom targetEngineer import ExpirationTargetEngineer\\n\\nfrom ML_setup import CONFIG\\nfrom ML_general_tools import *\\nfrom pathlib import Path\\n\\nprint(\\\"Imports and configuration ready\\\")\\n\\n# Build features, targets, and combined dataframe\\nraw_history = load_data(CONFIG[\\\"data\\\"][\\\"path\\\"])\\nhistory_slice = raw_history[-1000:]\\n\\n\\nfeature_params = dict(CONFIG[\\\"features\\\"][\\\"params\\\"])\\nheavy_cache_cfg = CONFIG[\\\"features\\\"].get(\\\"heavy_cache\\\", {})\\nheavy_cache_root = Path(heavy_cache_cfg.get(\\\"directory\\\", \\\"cache/heavy_features\\\"))\\n\\ncurrent_output_root_str = CONFIG[\\\"output\\\"][\\\"directory\\\"]\\ncurrent_output_root_path = Path(current_output_root_str)\\n\\npaths = {\\n    \\\"root\\\": current_output_root_path,\\n    \\\"feature_selection\\\": current_output_root_path / CONFIG[\\\"output\\\"][\\\"subdirectories\\\"][\\\"features\\\"],\\n    \\\"trained_models\\\": current_output_root_path / CONFIG[\\\"output\\\"][\\\"subdirectories\\\"][\\\"models\\\"],\\n    \\\"hpt_studies\\\": current_output_root_path / CONFIG[\\\"output\\\"][\\\"subdirectories\\\"][\\\"hpt\\\"],\\n    \\\"feature_cache\\\": current_output_root_path / CONFIG[\\\"output\\\"][\\\"subdirectories\\\"][\\\"cache\\\"]\\n}\\n\\n\\ncache_dir = heavy_cache_root\\ncache_dir.mkdir(parents=True, exist_ok=True)\\ncache_files = sorted(cache_dir.glob(\\\"heavy_features_v*.pkl\\\"))\\ncache_ready = bool(cache_files)\\nif cache_ready:\\n    print(f\\\"Heavy cache ready: {cache_files[-1].name} (total {len(cache_files)}) in {cache_dir}\\\")\\nelse:\\n    print(f\\\"No heavy cache file found in {cache_dir}; initial fit will populate.\\\")\\n\\n# existing_fe: Optional[FeatureEngineer] = None\\n# if \\\"feature_engineer\\\" in globals() and isinstance(feature_engineer, FeatureEngineer):\\n#     existing_fe = feature_engineer\\n\\n# if existing_fe is not None:\\n#     print(\\\"Reusing existing FeatureEngineer instance.\\\")\\n#     fe = existing_fe\\n# else:\\n#     print(\\\"Instantiating new FeatureEngineer instance.\\\")\\n#     fe = FeatureEngineer(verbose=feature_params.get(\\\"verbose\\\", False), **{k: v for k, v in feature_params.items() if k != \\\"verbose\\\"})\\n\\nfe = FeatureEngineer(verbose=feature_params.get(\\\"verbose\\\", False), **{k: v for k, v in feature_params.items() if k != \\\"verbose\\\"})\\n\\n\\ncache_ready = False  # Force rebuild for testing\\n\\nmanual_features = None\\nif cache_ready and fe.heavy_cache.load():\\n    print(\\\"Loaded heavy cache payload from disk; skipping rebuild.\\\")\\n    fe._heavy_payload = fe.heavy_cache.payload\\n    reference = fe._prepare_reference_frame(history_slice)\\n    fe._full_reference = reference\\n    manual_features = fe._compute_all_features(reference, build_heavy=False)\\n    fe.feature_names_out_ = manual_features.columns.tolist()\\n    fe._reference_features = manual_features\\nelse:\\n    print(\\\"Heavy cache not available or failed to load; running full fit.\\\")\\n    verbose_flag = feature_params.pop(\\\"verbose\\\", False)\\n    fe = FeatureEngineer(verbose=verbose_flag, **feature_params)\\n    fe.fit(history_slice)\\n    manual_features = fe.transform(history_slice)\\n\\nfeature_engineer = fe\\nfeatures = manual_features.copy()\\n\\n## Add tarrgets\\ntarget_engineer = ExpirationTargetEngineer(**CONFIG[\\\"targets\\\"][\\\"params\\\"])\\ntarget_engineer.fit(features)\\ntargets = target_engineer.transform(features)\\n\\n\\n\\n# --- 2b. Adding Derived Probability Features (from pre-trained models) ---\\nderived_proba_config = CONFIG[\\\"features\\\"].get(\\\"derived_probability_features\\\", {})\\nprint(f'derived_proba_config: {derived_proba_config}')\\nif derived_proba_config.get(\\\"enabled\\\", False):\\n    print(\\\"\\\\n2b. Adding Derived Probability Features\\\")\\n    features, newly_added_proba_features = generate_and_add_derived_probability_features(\\n        features.copy(),\\n        derived_proba_config,\\n        paths\\n    )\\n    if newly_added_proba_features:\\n        print(f\\\"  Successfully added derived probability features: {newly_added_proba_features}\\\")\\n        # Check for NaNs in each new feature\\n        for feat in newly_added_proba_features:\\n            if feat in features.columns:\\n                n_nans = features[feat].isna().sum()\\n                print(f\\\"    [NaN check] {feat}: {n_nans} NaNs ({n_nans/len(features):.2%} of rows)\\\")\\n            else:\\n                print(f\\\"    [NaN check] {feat}: not found in features DataFrame!\\\")\\n    else:\\n        print(\\\"  No new derived probability features were added (or generation was disabled).\\\")\\n\\ninitial_feature_names = list(features.columns)\\n\\n# Generate targets (your existing logic)\\nprint(initial_feature_names)\\n\\n\\n## deop pice columns from features\\n# drop_cols = [col for col in ['o', 'h', 'l', 'c'] if col in features.columns]\\n# if drop_cols: features = features.drop(columns=drop_cols)\\n\\n\\n\",\"internalMetadata\":{\"executionOrder\":2,\"executionId\":\"06e5b921-6d6e-479c-9fc3-2361400257bc\",\"runStartTime\":1764168698156,\"runEndTime\":1764168703756,\"lastRunSuccess\":true,\"renderDuration\":{\"vscode.builtin-renderer\":2},\"runStartTimeAdjustment\":0,\"internalId\":\"4dddeab0\"}},{\"cellKind\":2,\"language\":\"python\",\"metadata\":{\"execution_count\":9,\"id\":\"a4c09e20\",\"metadata\":{}},\"outputs\":[],\"mime\":\"text/plain\",\"source\":\"from targetEngineer import VolatilityRegimeEngineer\\ndf_train = features.copy()\\n\\n\\nregime_engineer = VolatilityRegimeEngineer(\\n    lookback_window=24*7,    # 1 week for deseasonalized vol\\n    seasonal_window=24*30,    # 30 days to learn patterns\\n    forward_window=24,      # 12h forward classification\\n    trend_std=1.2,\\n    jump_std=4.6,\\n    jump_speed_window=6  # Jump must occur within 3 time units\\n\\n)\\n\\nregime_engineer.fit(df_train)\\ntargets = regime_engineer.transform(df_train)\\n\",\"internalMetadata\":{\"executionId\":\"11ca7280-6751-49f1-97d3-529f03c4ccbc\",\"runStartTime\":1764168900752,\"runEndTime\":1764168906514,\"lastRunSuccess\":true,\"executionOrder\":9,\"runStartTimeAdjustment\":0,\"internalId\":\"2e4c675a\"}},{\"cellKind\":2,\"language\":\"python\",\"metadata\":{\"execution_count\":10,\"id\":\"d494db24\",\"metadata\":{}},\"outputs\":[{\"outputId\":\"48a5ba93-b1e7-4999-8639-29491d6a7600\",\"metadata\":{\"outputType\":\"stream\"},\"outputs\":[{\"data\":{\"type\":\"ArrayBuffer-4f56482b-5a03-49ba-8356-210d3b0c1c3d\",\"data\":\"cmVnaW1lX2xhYmVsCjAgICAgNjYyCjEgICAgMTQ5CjIgICAgMTA1Ck5hbWU6IGNvdW50LCBkdHlwZTogSW50NjQK\"},\"mime\":\"application/vnd.code.notebook.stdout\"}]}],\"source\":\"# Check distribution\\ndistribution = regime_engineer.get_regime_distribution(df_train)\\nprint(distribution)\",\"internalMetadata\":{\"executionOrder\":10,\"executionId\":\"b724e3cc-fad8-45a3-a46d-5ff440bab5d6\",\"runStartTime\":1764168906518,\"runEndTime\":1764168912311,\"lastRunSuccess\":true,\"renderDuration\":{\"vscode.builtin-renderer\":0},\"runStartTimeAdjustment\":0,\"internalId\":\"a83da7b5\"}},{\"cellKind\":2,\"language\":\"python\",\"metadata\":{\"execution_count\":10,\"id\":\"a9f4c760\",\"metadata\":{}},\"outputs\":[{\"outputId\":\"1537a6e6-b248-49d7-b8ea-46caa25e52ff\",\"metadata\":{\"outputType\":\"execute_result\",\"executionCount\":10,\"metadata\":{}},\"outputs\":[{\"data\":{\"type\":\"ArrayBuffer-4f56482b-5a03-49ba-8356-210d3b0c1c3d\",\"data\":\"PGRpdj4KPHN0eWxlIHNjb3BlZD4KICAgIC5kYXRhZnJhbWUgdGJvZHkgdHIgdGg6b25seS1vZi10eXBlIHsKICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgfQoKICAgIC5kYXRhZnJhbWUgdGJvZHkgdHIgdGggewogICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7CiAgICB9CgogICAgLmRhdGFmcmFtZSB0aGVhZCB0aCB7CiAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICB9Cjwvc3R5bGU+Cjx0YWJsZSBib3JkZXI9IjEiIGNsYXNzPSJkYXRhZnJhbWUiPgogIDx0aGVhZD4KICAgIDx0ciBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQ7Ij4KICAgICAgPHRoPjwvdGg+CiAgICAgIDx0aD5yZWdpbWVfbGFiZWw8L3RoPgogICAgICA8dGg+bWF4X2Z3ZF96X3Njb3JlPC90aD4KICAgICAgPHRoPm1heF9qdW1wX3pfc2NvcmU8L3RoPgogICAgICA8dGg+Ym94X3N0ZDwvdGg+CiAgICAgIDx0aD5ib3hfc3RkX2FubnVhbGl6ZWQ8L3RoPgogICAgPC90cj4KICA8L3RoZWFkPgogIDx0Ym9keT4KICAgIDx0cj4KICAgICAgPHRoPjIwMjUtMTAtMTUgMjA6MDA6MDA8L3RoPgogICAgICA8dGQ+Jmx0O05BJmd0OzwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgPC90cj4KICAgIDx0cj4KICAgICAgPHRoPjIwMjUtMTAtMTUgMjE6MDA6MDA8L3RoPgogICAgICA8dGQ+Jmx0O05BJmd0OzwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgPC90cj4KICAgIDx0cj4KICAgICAgPHRoPjIwMjUtMTAtMTUgMjI6MDA6MDA8L3RoPgogICAgICA8dGQ+Jmx0O05BJmd0OzwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgPC90cj4KICAgIDx0cj4KICAgICAgPHRoPjIwMjUtMTAtMTUgMjM6MDA6MDA8L3RoPgogICAgICA8dGQ+Jmx0O05BJmd0OzwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgPC90cj4KICAgIDx0cj4KICAgICAgPHRoPjIwMjUtMTAtMTYgMDA6MDA6MDA8L3RoPgogICAgICA8dGQ+Jmx0O05BJmd0OzwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD5OYU48L3RkPgogICAgPC90cj4KICAgIDx0cj4KICAgICAgPHRoPi4uLjwvdGg+CiAgICAgIDx0ZD4uLi48L3RkPgogICAgICA8dGQ+Li4uPC90ZD4KICAgICAgPHRkPi4uLjwvdGQ+CiAgICAgIDx0ZD4uLi48L3RkPgogICAgICA8dGQ+Li4uPC90ZD4KICAgIDwvdHI+CiAgICA8dHI+CiAgICAgIDx0aD4yMDI1LTExLTI2IDA3OjAwOjAwPC90aD4KICAgICAgPHRkPjA8L3RkPgogICAgICA8dGQ+MC40MDE3Mzk8L3RkPgogICAgICA8dGQ+MC4wPC90ZD4KICAgICAgPHRkPjAuMDA3NDM3PC90ZD4KICAgICAgPHRkPjAuNjk2MDU5PC90ZD4KICAgIDwvdHI+CiAgICA8dHI+CiAgICAgIDx0aD4yMDI1LTExLTI2IDA4OjAwOjAwPC90aD4KICAgICAgPHRkPjA8L3RkPgogICAgICA8dGQ+MC4yNDE4ODA8L3RkPgogICAgICA8dGQ+MC4wPC90ZD4KICAgICAgPHRkPjAuMDA3NDMxPC90ZD4KICAgICAgPHRkPjAuNjk1NTE4PC90ZD4KICAgIDwvdHI+CiAgICA8dHI+CiAgICAgIDx0aD4yMDI1LTExLTI2IDA5OjAwOjAwPC90aD4KICAgICAgPHRkPjA8L3RkPgogICAgICA8dGQ+MC4wNzA3MzA8L3RkPgogICAgICA8dGQ+MC4wPC90ZD4KICAgICAgPHRkPjAuMDA3NDMwPC90ZD4KICAgICAgPHRkPjAuNjk1NDIwPC90ZD4KICAgIDwvdHI+CiAgICA8dHI+CiAgICAgIDx0aD4yMDI1LTExLTI2IDEwOjAwOjAwPC90aD4KICAgICAgPHRkPjA8L3RkPgogICAgICA8dGQ+MC4wMTkyNjU8L3RkPgogICAgICA8dGQ+MC4wPC90ZD4KICAgICAgPHRkPjAuMDA3NDMwPC90ZD4KICAgICAgPHRkPjAuNjk1MzkyPC90ZD4KICAgIDwvdHI+CiAgICA8dHI+CiAgICAgIDx0aD4yMDI1LTExLTI2IDExOjAwOjAwPC90aD4KICAgICAgPHRkPiZsdDtOQSZndDs8L3RkPgogICAgICA8dGQ+TmFOPC90ZD4KICAgICAgPHRkPk5hTjwvdGQ+CiAgICAgIDx0ZD4wLjAwNzQyMTwvdGQ+CiAgICAgIDx0ZD4wLjY5NDU5MDwvdGQ+CiAgICA8L3RyPgogIDwvdGJvZHk+CjwvdGFibGU+CjxwPjEwMDAgcm93cyDDlyA1IGNvbHVtbnM8L3A+CjwvZGl2Pg==\"},\"mime\":\"text/html\"},{\"data\":{\"type\":\"ArrayBuffer-4f56482b-5a03-49ba-8356-210d3b0c1c3d\",\"data\":\"ICAgICAgICAgICAgICAgICAgICAgcmVnaW1lX2xhYmVsICBtYXhfZndkX3pfc2NvcmUgIG1heF9qdW1wX3pfc2NvcmUgIFwKMjAyNS0xMC0xNSAyMDowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKMjAyNS0xMC0xNSAyMTowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKMjAyNS0xMC0xNSAyMjowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKMjAyNS0xMC0xNSAyMzowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKMjAyNS0xMC0xNiAwMDowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKLi4uICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uICAgICAgICAgICAgICAuLi4gICAgICAgICAgICAgICAuLi4gICAKMjAyNS0xMS0yNiAwNzowMDowMCAgICAgICAgICAgICAwICAgICAgICAgMC40MDE3MzkgICAgICAgICAgICAgICAwLjAgICAKMjAyNS0xMS0yNiAwODowMDowMCAgICAgICAgICAgICAwICAgICAgICAgMC4yNDE4ODAgICAgICAgICAgICAgICAwLjAgICAKMjAyNS0xMS0yNiAwOTowMDowMCAgICAgICAgICAgICAwICAgICAgICAgMC4wNzA3MzAgICAgICAgICAgICAgICAwLjAgICAKMjAyNS0xMS0yNiAxMDowMDowMCAgICAgICAgICAgICAwICAgICAgICAgMC4wMTkyNjUgICAgICAgICAgICAgICAwLjAgICAKMjAyNS0xMS0yNiAxMTowMDowMCAgICAgICAgICA8TkE+ICAgICAgICAgICAgICBOYU4gICAgICAgICAgICAgICBOYU4gICAKCiAgICAgICAgICAgICAgICAgICAgICBib3hfc3RkICBib3hfc3RkX2FubnVhbGl6ZWQgIAoyMDI1LTEwLTE1IDIwOjAwOjAwICAgICAgIE5hTiAgICAgICAgICAgICAgICAgTmFOICAKMjAyNS0xMC0xNSAyMTowMDowMCAgICAgICBOYU4gICAgICAgICAgICAgICAgIE5hTiAgCjIwMjUtMTAtMTUgMjI6MDA6MDAgICAgICAgTmFOICAgICAgICAgICAgICAgICBOYU4gIAoyMDI1LTEwLTE1IDIzOjAwOjAwICAgICAgIE5hTiAgICAgICAgICAgICAgICAgTmFOICAKMjAyNS0xMC0xNiAwMDowMDowMCAgICAgICBOYU4gICAgICAgICAgICAgICAgIE5hTiAgCi4uLiAgICAgICAgICAgICAgICAgICAgICAgLi4uICAgICAgICAgICAgICAgICAuLi4gIAoyMDI1LTExLTI2IDA3OjAwOjAwICAwLjAwNzQzNyAgICAgICAgICAgIDAuNjk2MDU5ICAKMjAyNS0xMS0yNiAwODowMDowMCAgMC4wMDc0MzEgICAgICAgICAgICAwLjY5NTUxOCAgCjIwMjUtMTEtMjYgMDk6MDA6MDAgIDAuMDA3NDMwICAgICAgICAgICAgMC42OTU0MjAgIAoyMDI1LTExLTI2IDEwOjAwOjAwICAwLjAwNzQzMCAgICAgICAgICAgIDAuNjk1MzkyICAKMjAyNS0xMS0yNiAxMTowMDowMCAgMC4wMDc0MjEgICAgICAgICAgICAwLjY5NDU5MCAgCgpbMTAwMCByb3dzIHggNSBjb2x1bW5zXQ==\"},\"mime\":\"text/plain\"}]}],\"source\":\"targets\",\"internalMetadata\":{\"executionId\":\"71afb8a5-ca2a-45e3-b46c-361707ac6238\",\"runStartTime\":1764166812504,\"runEndTime\":1764166812506,\"lastRunSuccess\":true,\"executionOrder\":10,\"runStartTimeAdjustment\":0,\"internalId\":\"b63ab08c\"}},{\"cellKind\":2,\"language\":\"python\",\"metadata\":{\"execution_count\":null,\"id\":\"526b7630\",\"metadata\":{}},\"outputs\":[],\"source\":\"import matplotlib.pyplot as plt\\nimport numpy as np\\n\\n# Pick a random 1-month period (720 hours)\\ntotal_rows = len(targets)\\nif total_rows > 720:\\n    start_idx = np.random.randint(0, total_rows - 720)\\n    end_idx = start_idx + 720\\nelse:\\n    start_idx = 0\\n    end_idx = total_rows\\n\\n# Slice data for the period\\nperiod_data = features.iloc[start_idx:end_idx].copy()\\nperiod_targets = targets.iloc[start_idx:end_idx].copy()\\n\\n# Get price and regime\\nprice = period_data['c'] if 'c' in period_data.columns else period_data.index.to_series()\\nregime = period_targets['regime_label']\\n\\n# Create figure with 2 subplots\\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(15, 8), sharex=True)\\n\\n# Plot 1: Price with regime background colors\\nax1.plot(price.index, price.values, color='black', linewidth=1.5, label='Close Price')\\nax1.set_ylabel('Price', fontsize=12)\\nax1.set_title(f'Price and Volatility Regimes\\\\n{price.index[0]} to {price.index[-1]}', fontsize=14)\\nax1.grid(True, alpha=0.3)\\nax1.legend(loc='upper left')\\n\\n# Add colored background for regimes\\nregime_colors = {0: 'lightgreen', 1: 'lightyellow', 2: 'lightcoral'}\\nregime_labels = {0: 'Chop/Mean Reversion', 1: 'Trending', 2: 'Jump/Event'}\\n\\ny_min, y_max = ax1.get_ylim()\\ncurrent_regime = None\\nstart_x = None\\n\\nfor i, (idx, reg) in enumerate(regime.items()):\\n    if pd.notna(reg):\\n        reg = int(reg)\\n        if reg != current_regime:\\n            # End previous regime block\\n            if current_regime is not None and start_x is not None:\\n                ax1.axvspan(start_x, idx, alpha=0.2, color=regime_colors.get(current_regime, 'white'))\\n            # Start new regime block\\n            current_regime = reg\\n            start_x = idx\\n            \\n# Fill last regime block\\nif current_regime is not None and start_x is not None:\\n    ax1.axvspan(start_x, regime.index[-1], alpha=0.2, color=regime_colors.get(current_regime, 'white'))\\n\\n# Plot 2: Regime as colored bars\\nregime_numeric = regime.fillna(-1)\\ncolors = [regime_colors.get(int(r), 'gray') if r >= 0 else 'gray' for r in regime_numeric]\\n\\nax2.bar(regime.index, [1]*len(regime), color=colors, width=0.04, edgecolor='none')\\nax2.set_ylabel('Regime', fontsize=12)\\nax2.set_yticks([0.5])\\nax2.set_yticklabels([''])\\nax2.set_ylim(0, 1)\\nax2.grid(True, alpha=0.3, axis='x')\\n\\n# Add legend for regimes\\nfrom matplotlib.patches import Patch\\nlegend_elements = [Patch(facecolor=regime_colors[0], label='0: Chop/Mean Reversion'),\\n                   Patch(facecolor=regime_colors[1], label='1: Trending'),\\n                   Patch(facecolor=regime_colors[2], label='2: Jump/Event')]\\nax2.legend(handles=legend_elements, loc='upper right', ncol=3)\\n\\nplt.xlabel('Time', fontsize=12)\\nplt.tight_layout()\\nplt.show()\\n\\n# Print some stats for this period\\nprint(f\\\"\\\\nPeriod: {price.index[0]} to {price.index[-1]}\\\")\\nprint(f\\\"Regime distribution:\\\")\\nregime_counts = regime.value_counts().sort_index()\\nfor reg, count in regime_counts.items():\\n    if pd.notna(reg):\\n        reg_int = int(reg)\\n        pct = count / len(regime) * 100\\n        print(f\\\"  Class {reg_int} ({regime_labels.get(reg_int, 'Unknown')}): {count} hours ({pct:.1f}%)\\\")\\n\",\"internalMetadata\":{\"executionId\":\"14c2ed1c-196c-4138-97a2-e1226911718c\",\"internalId\":\"ebc332a8\"}}],\"metadata\":{\"metadata\":{\"kernelspec\":{\"display_name\":\".venv\",\"language\":\"python\",\"name\":\"python3\"},\"language_info\":{\"codemirror_mode\":{\"name\":\"ipython\",\"version\":3},\"file_extension\":\".py\",\"mimetype\":\"text/x-python\",\"name\":\"python\",\"nbconvert_exporter\":\"python\",\"pygments_lexer\":\"ipython3\",\"version\":\"3.13.7\"}},\"nbformat\":4,\"nbformat_minor\":5}}"]